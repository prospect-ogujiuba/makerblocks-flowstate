# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Makerblocks is a custom WordPress plugin providing Gutenberg blocks for Full Site Editing (FSE). It's built with React, TailwindCSS, and WordPress block development tools.

## Build Commands

### Development
```bash
npm run dev
```
Runs parallel processes for:
- TailwindCSS watch mode
- SASS compilation (watch mode)
- WordPress scripts start (for general scripts)
- WordPress scripts start (for blocks)

### Production Build
```bash
npm run prod
```
Sequential build pipeline that:
- Builds TailwindCSS (minified)
- Compiles SASS (compressed)
- Builds WordPress scripts
- Builds blocks with experimental modules

### Individual Build Tasks
```bash
npm run tailwind-watch      # Watch TailwindCSS compilation
npm run tailwind-build      # Build TailwindCSS (minified)
npm run sass-dev            # Watch SASS compilation
npm run sass-prod           # Build SASS (compressed)
npm run wp-start            # Watch general scripts
npm run wp-build            # Build general scripts
npm run wp-start-blocks     # Watch blocks development
npm run wp-build-blocks     # Build blocks
```

### Preview
```bash
npm run preview
```
Starts BrowserSync proxy at `prospectogujiuba.test` with live reload.

### Code Quality
```bash
npm run format              # Format code
npm run lint:css            # Lint CSS
npm run lint:js             # Lint JavaScript
```

## Architecture

### Plugin Structure

**Main Entry Point:** `makerblocks.php`
- Defines constants: `MAKERBLOCKS_PLUGIN_DIR`, `MAKERBLOCKS_PLUGIN_URL`, `MAKERSTARTER_THEME_DIR`, `MAKERSTARTER_THEME_URL`
- Loads modular PHP files from `inc/` directory

**PHP Module System:**
The plugin uses a modular include system (`inc/` directory):
- `blocks.php` - Block registration and configuration
- `enqueue_assets.php` - Asset registration and enqueuing (front-end, editor, admin)
- `post_types.php` - Custom post type registration (currently empty)
- `helpers.php` - Utility functions (breadcrumbs, 404 redirect)
- `variables.php` - Global PHP variables for versioning
- `wp_localize.php` - Passes PHP data to JavaScript via `wp_localize_script`

### Block Development

**Source Location:** `src/blocks-dev/{block-name}/`
**Build Output:** `blocks/{block-name}/`

Each block contains:
- `block.json` - Block metadata and configuration
- `index.js` - Block registration
- `edit.js` - Editor component (React)
- `render.php` - Server-side rendering

**Block Registration Flow:**
1. Blocks are listed in `makerblocks_get_custom_blocks()` in `inc/blocks.php`
2. Each block is registered via `register_block_type()` pointing to the built directory
3. Custom block categories are added: `makerblocks-templates`, `makerblocks-layout`, `makerblocks`

### Asset Pipeline

**Source Paths:**
- JavaScript: `src/scripts/` → `assets/js/`
- Styles: `src/styles/` → `assets/css/`
- Blocks: `src/blocks-dev/` → `blocks/`

**Styling Architecture:**
- SASS structure: `src/styles/` contains `abstracts/`, `base/`, `components/`, `layout/`, `pages/`, `vendors/`
- TailwindCSS source: `src/styles/vendors/tailwind/_source.scss` → `_tailwind.scss`
- Bootstrap Icons included via CDN reference

**Asset Registration:**
The plugin uses `.asset.php` files generated by `@wordpress/scripts` for dependency management. The helper function `makerblocks_register_asset()` in `inc/enqueue_assets.php` handles registration.

### Data Flow to Frontend

**PHP to JavaScript:**
`inc/wp_localize.php` exposes extensive site data via `wp_localize_script` as the `siteData` global:
- Site information (name, URLs, REST API endpoint)
- User information (only when logged in)
- Current page/post context
- Environment details
- REST nonce for authenticated requests

**Block Component Data:**
Dynamic blocks receive server-rendered data via the `component-data` attribute (see `src/blocks-dev/flowstate/render.php` for example).

### TailwindCSS Integration

**Safelist System:**
The plugin includes an extensive TailwindCSS safelist in `inc/safelist-classes/` organized by category:
- `accessibility.js`, `backgrounds.js`, `borders.js`, `effects.js`, `filters.js`
- `flexbox-grid.js`, `interactivity.js`, `layout.js`, `sizing.js`, `spacing.js`
- `svg.js`, `tables.js`, `transforms.js`, `transitions-animations.js`, `typography.js`
- All modules are consolidated in `inc/safelist-classes/index.js`

These safelisted classes ensure TailwindCSS doesn't purge dynamically-added utility classes.

## Development Workflow

### Adding a New Block

1. Create block directory in `src/blocks-dev/{block-name}/`
2. Add required files: `block.json`, `index.js`, `edit.js`, `render.php` (if dynamic)
3. Add block name to `makerblocks_get_custom_blocks()` in `inc/blocks.php`
4. Run `npm run wp-start-blocks` for development
5. Build with `npm run wp-build-blocks` for production

### Working with Styles

- Edit SCSS files in `src/styles/`
- TailwindCSS utilities are processed from `src/styles/vendors/tailwind/_source.scss`
- Run `npm run dev` to watch all style changes
- Final output: `assets/css/styles.css`

### Working with Scripts

- JavaScript source: `src/scripts/`
- Compiled output: `assets/js/`
- Uses WordPress Dependency Extraction Webpack Plugin for proper dependency management

## Important Notes

- The plugin depends on WordPress 6.5+ and PHP 7.0+
- Block builds use `--experimental-modules` flag for ES module support
- Asset versioning uses file modification time from compiled assets
- All 404 errors are redirected to home page (see `inc/helpers.php`)
- Currently, only the "flowstate" block is registered
- Carbon Fields is included in vendor but not currently loaded (commented out in main plugin file)

### Flowstate / Dashboard rules

- Work in `@src/scripts/apps/flowstate` only, reuse existing components, no new libs.
- Dashboard must be dynamic on user context:
	- no user → show `pages/Lander.js` + login/register actions
	- user present → show `layouts/DashboardLayout` experience
- Use existing auth/user/session primitives if found; else design minimal context/store pattern.
- Before coding: always give a short PLAN:
	- overview
	- files to touch (paths)
	- state/data flow
	- step-by-step checklist
- Do not scaffold a new React app; this repo already has app shell and build.
- Prefer concise answers, code pointers > long prose.
